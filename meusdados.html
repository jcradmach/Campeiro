<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
   <title>Expressão do Gaudério</title>
    <link rel="icon" type="image/png" href="favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="css/style3.css" rel="stylesheet">
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="manifest" href="/manifest.json">
</head>
<body>
  <div class="mainscreen">
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <!-- Mobile: Primeira linha - Logo + Carrinho + Toggle -->
            <div class="d-flex w-100 justify-content-between align-items-center d-lg-none">
                <!-- Logo -->
                <a class="navbar-brand d-flex align-items-center" href="catalogo.html">
                    <img src="Imagens/logo.png" alt="logo" class="logo-header me-2">
                    <span>Expressão do Gaudério</span>
                </a>
                
                <!-- Carrinho + Toggle -->
                <div class="d-flex align-items-center">
                    <a href="carrinho.html" class="btn btn-link text-white position-relative px-2 me-2">
                        <i class="fas fa-shopping-cart fs-5"></i>
                        <span id="carrinho-contador" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger cart-badge">
                            0
                        </span>
                    </a>
                    
                    <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
            
            <!-- Desktop: Logo (esquerda) -->
            <a class="navbar-brand d-none d-lg-flex align-items-center" href="index.html">
                <img src="Imagens/logo.png" alt="logo" class="logo-header me-2">
                <span>Expressão do Gaudério</span>
            </a>
            
            <!-- Desktop: Carrinho + User Info (direita) -->
            <div class="d-none d-lg-flex align-items-center ms-auto">
                <!-- Carrinho -->
                <a href="carrinho.html" class="btn btn-link text-white position-relative px-3 me-3">
                    <i class="fas fa-shopping-cart fs-5"></i>
                    <span id="carrinho-contador-desktop" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger cart-badge">
                        0
                    </span>
                </a>
                
                <!-- User Info -->
                <div class="d-flex align-items-center user-section">
                    <i class="fas fa-user-circle me-2"></i>
                    <span class="text-white me-3">Olá, <span id="user-name">usuário</span></span>
                    
                    <div class="d-none" id="user-info">
                        <button class="btn btn-sm btn-outline-light" id="logout-btn">
                            <i class="fas fa-sign-out-alt me-1"></i>Sair
                        </button>
                    </div>
                    
                    <div class="auth-buttons" id="auth-buttons">
                        <a href="cadastro.html" class="btn btn-sm btn-outline-light me-2">
                            <i class="fas fa-user-plus me-1"></i>Cadastre-se
                        </a>
                        <a href="login.html" class="btn btn-sm btn-outline-light">
                            <i class="fas fa-sign-in-alt me-1"></i>Entrar
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Menu Collapse -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- Mobile: Segunda linha - User Info -->
                <div class="d-lg-none">
                    <div class="d-flex justify-content-between align-items-center user-section">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-user-circle me-2"></i>
                            <span class="text-white">Olá, <span id="user-namem">usuário</span></span>
                        </div>
                        
                        <div class="d-none" id="user-infom">
                            <button class="btn btn-sm btn-outline-light" id="logout-btnm">
                                <i class="fas fa-sign-out-alt me-1"></i>Sair
                            </button>
                        </div>
                        
                        <div class="auth-buttons" id="auth-buttonsm">
                            <a href="cadastro.html" class="btn btn-sm btn-outline-light me-2">
                                <i class="fas fa-user-plus me-1"></i>Cadastre-se
                            </a>
                            <a href="login.html" class="btn btn-sm btn-outline-light">
                                <i class="fas fa-sign-in-alt me-1"></i>Entrar
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Menu Items -->
                <ul class="navbar-nav">
                    <!-- Seção Admin -->
                    <div id="adminicons" class="admin-section">
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="menu.html">
                            <i class="fas fa-tasks me-2"></i>
                            Painel Admin
                        </a>
                    </li>
                </div>
                    
                    <!-- Seção User -->
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="pedidos.html">
                            <i class="fas fa-shopping-bag me-2"></i>
                            Meus Pedidos
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="meusdados.html">
                            <i class="fas fa-user-edit me-2"></i>
                            Minha Conta
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="ajuda.html">
                            <i class="fas fa-life-ring me-2"></i>
                            Ajuda
                        </a>
                    </li>
                </ul>
            </div>
        </div>
</nav>
  <div class="page-container">
  <div class="container py-5">
    <h2 class="text-center">Meus Dados</h2>
    <div id="loading" class="d-flex justify-content-center align-items-center vh-100">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Carregando...</span>
        </div>
      </div>
    <div id="conteudo" style="display: none;">

    <div id="dados-usuario" class="my-4">
      <div class="mb-3">
        <label class="form-label">Nome</label>
        <input type="text" id="nome" class="form-control"/>
      </div>
      <div class="mb-3">
        <label class="form-label">Telefone</label>
        <input type="text" id="telefone" class="form-control"/>
      </div>
      <button class="btn btn-primary" id="salvar-dados">Salvar Dados</button>
    </div>

    <hr />

    <h4>Endereços de Entrega</h4>
    <div id="lista-enderecos" class="mb-3"></div>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#endereco-modal">Adicionar Novo Endereço</button>
  </div>
</div>
</div>

<footer class="footer">
<div class="container">
    <div class="footer-content">
        <div class="footer-logo">
            
<img src="Imagens/logo.png" alt="LeCake" class="logo-header me-2" style="height: 60px;">


<a href="index.html"><p style="color: white;">Cousa de Guapo, chê</p></a>
           <div class="social-icons d-flex justify-content-center gap-4">
<a href="https://www.instagram.com/jmollermachado" 
 target="_blank" 
 class="social-icon" 
 style="font-size: 1rem; color: white;" 
 title="Instagram">
<i class="fab fa-instagram"></i>
</a>

<a href="https://wa.me/555185407492" 
 target="_blank" 
 class="social-icon" 
 style="font-size: 1rem; color: white;" 
 title="WhatsApp">
<i class="fab fa-whatsapp"></i>
</a>
</div>
        </div>
        
        
    </div>
    <div class="copyright">
        &copy; 2025 Expressão do Gaudério - Todos os direitos reservados
    </div>
</div>
</footer>
  </div>

  <!-- Modal para Adicionar Endereço -->
<div class="modal fade" id="endereco-modal" tabcatalogo.html="-1" aria-labelledby="endereco-modal-label" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="endereco-modal-label">Adicionar Endereço</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="form-endereco">
                    <div class="mb-3">
                        <label for="cep" class="form-label">CEP</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="cep" required>
                            <button class="btn btn-outline-secondary" type="button" id="buscar-cep">
                                <i class="bi bi-search"></i> Buscar
                            </button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="rua" class="form-label">Rua</label>
                        <input type="text" class="form-control" id="rua" required>
                    </div>
                    <div class="mb-3">
                        <label for="numero" class="form-label">Número</label>
                        <input type="text" class="form-control" id="numero" required>
                    </div>
                    <div class="mb-3">
                        <label for="complemento" class="form-label">Complemento (opcional)</label>
                        <input type="text" class="form-control" id="complemento">
                    </div>
                    <div class="mb-3">
                        <label for="bairro" class="form-label">Bairro</label>
                        <input type="text" class="form-control" id="bairro" required>
                    </div>
                    <div class="mb-3">
                        <label for="cidade" class="form-label">Cidade</label>
                        <input type="text" class="form-control" id="cidade" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="salvar-endereco">Salvar Endereço</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script type="module" src="src/auth.js"></script>
<script type="module" src="src/database.js"></script>

<script type="module">
  import { auth, database, ref, get, set, push } from "./src/main.js";
  import { carregarEnderecos, salvarEndereco } from "./src/carrinho.js";

  document.addEventListener("DOMContentLoaded", async () => {
auth.onAuthStateChanged(async (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  try {
    // Carrega dados pessoais
    const userRef = ref(database, `users/${user.uid}`);
    const snapshot = await get(userRef);
    const userData = snapshot.val() || {};
    document.getElementById("nome").value = userData.nome || "";
    document.getElementById("telefone").value = userData.telefone || "";
    document.getElementById("loading").classList.add("hidden");

    // Carrega endereços
    const enderecos = await carregarEnderecos();
    const listaContainer = document.getElementById("lista-enderecos");
    if (enderecos) {
      listaContainer.innerHTML = Object.entries(enderecos).map(([id, e]) => `
        <div class="card mb-2">
          <div class="card-body">
            <p><strong>${e.rua}, ${e.numero}</strong> - ${e.bairro}, ${e.cidade} (${e.cep})</p>
            ${e.complemento ? `<p>Complemento: ${e.complemento}</p>` : ""}
          </div>
        </div>
      `).join("");
    } else {
      listaContainer.innerHTML = "<p>Nenhum endereço cadastrado.</p>";
    }

  } catch (error) {
    console.error(error);
    Swal.fire("Erro", "Falha ao carregar seus dados.", "error");
  } finally {
    // Oculta o loading e mostra o conteúdo
    
    document.getElementById("conteudo").style.display = "block";
  }
});
});


  // Salvar dados pessoais
  document.getElementById("salvar-dados").addEventListener("click", async () => {
    const user = auth.currentUser;
    if (!user) return;

    const nome = document.getElementById("nome").value.trim();
    const telefone = document.getElementById("telefone").value.trim();

    if (!nome || !telefone) {
      Swal.fire("Erro", "Preencha todos os campos", "warning");
      return;
    }

    try {
      const userRef = ref(database, `users/${user.uid}`);
      await set(userRef, { nome, telefone });
      Swal.fire("Sucesso", "Dados atualizados com sucesso", "success");
    } catch (error) {
      console.error("Erro ao salvar dados:", error);
      Swal.fire("Erro", "Não foi possível salvar seus dados", "error");
    }
  });

  // CEP lookup
  document.getElementById("buscar-cep").addEventListener("click", async () => {
    const cep = document.getElementById('cep').value.replace(/\D/g, '');
    if (cep.length !== 8) {
      Swal.fire('Erro', 'CEP inválido. Digite 8 números.', 'error');
      return;
    }

    try {
      const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
      const data = await response.json();
      if (data.erro) throw new Error("CEP não encontrado");

      document.getElementById('rua').value = data.logradouro;
      document.getElementById('bairro').value = data.bairro;
      document.getElementById('cidade').value = data.localidade;
      document.getElementById('numero').focus();
      Swal.fire("Sucesso", "Endereço preenchido automaticamente!", "success");
    } catch (error) {
      Swal.fire("Erro", "CEP não encontrado ou falha na busca.", "error");
    }
  });

  // Salvar endereço
  document.getElementById("salvar-endereco").addEventListener("click", async () => {
    const endereco = {
      cep: document.getElementById("cep").value.trim(),
      rua: document.getElementById("rua").value.trim(),
      numero: document.getElementById("numero").value.trim(),
      complemento: document.getElementById("complemento").value.trim(),
      bairro: document.getElementById("bairro").value.trim(),
      cidade: document.getElementById("cidade").value.trim(),
    };

    if (!endereco.cep || !endereco.rua || !endereco.numero || !endereco.bairro || !endereco.cidade) {
      Swal.fire("Erro", "Preencha todos os campos obrigatórios.", "warning");
      return;
    }

    try {
      await salvarEndereco(endereco);
      Swal.fire("Sucesso", "Endereço salvo com sucesso", "success").then(() => {
        window.location.reload();
      });
    } catch (error) {
      Swal.fire("Erro", "Falha ao salvar endereço", "error");
    }
  });
</script>

</body>
</html>
